//整合web-uploader
define(function(){
        //Q.js代码
        !function(t,e){"use strict";function n(t,n){return t!==e?t:n}function r(t){return"[object Function]"===N.call(t)}function i(t){return"number"==typeof t&&t>0&&t===Math.floor(t)}function o(t,e){return r(t)?t.apply(e,C.call(arguments,2)):void 0}function a(t,n,r){if(!t||!n)return t;for(var i in n)i!=e&&B.call(n,i)&&(r||t[i]===e)&&(t[i]=n[i]);return t}function l(t,e){if(e!==!1&&!/^[\],:{}\s]*$/.test(t.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))throw new Error("JSON SyntaxError");try{return new Function("return "+t)()}catch(n){}}function u(t,n){1>=n&&(n*=100),t.style.opacity!=e?t.style.opacity=n/100:t.style.filter!=e&&(t.style.filter="alpha(opacity="+parseInt(n)+")")}function c(t,e){var n=0,r=0,i=t.offsetWidth,o=t.offsetHeight;do n+=t.offsetLeft,r+=t.offsetTop,t=t.offsetParent;while(t&&t!=e);return{left:n,top:r,width:i,height:o}}function f(t,e,n,r){for(var i=t[n||e],o=[];i;){if(1==i.nodeType){if(!r)return i;o.push(i)}i=i[e]}return r?o:null}function s(t){return t.previousElementSibling||f(t,"previousSibling",null,!1)}function v(t){return t.nextElementSibling||f(t,"nextSibling",null,!1)}function p(t){return t.firstElementChild||f(t,"nextSibling","firstChild",!1)}function d(t){return t.lastElementChild||f(t,"previousSibling","lastChild",!1)}function h(t){return t.children||f(t,"nextSibling","firstChild",!0)}function g(t,e,n){var r=document.createElement(t);return e&&(r.className=e),n&&(r.innerHTML=n),r}function E(t,e){var n=g("div","",t);return e?n.childNodes:p(n)}function m(e){var n=e||t.event;return n.target||(n.target=n.srcElement),n}function y(t,e,n,r){var i=function(o){n.call(t,m(o)),r&&j(t,e,i)};return H(t,e,i),r?void 0:{stop:function(){j(t,e,i)}}}function b(t,e){if(r(t[e]))t[e]();else if(t.fireEvent)t.fireEvent("on"+e);else if(t.dispatchEvent){var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!0),t.dispatchEvent(n)}}function x(t,e,n){var r=m(t);e!==!1&&(r.preventDefault?r.preventDefault():r.returnValue=!1),n!==!1&&(r.stopPropagation?r.stopPropagation():r.cancelBubble=!0)}function S(t){return F.test(t)}function O(t){if(!S(t))return!0;var n=RegExp.lastMatch.length,r=t.indexOf("/",n),i=t.slice(0,-1!=r?r:e);return i.toLowerCase()==(location.protocol+"//"+location.host).toLowerCase()}function w(t,e,n){t=+t,e=e||1024;for(var r=0,o="number"==typeof e,a=1,l=i(n)?n:o?100:e.length;t>=a&&l>r;)a*=o?e:e[r],r++;return r&&a>t&&(a/=o?e:e.last(),r--),{value:r?t/a:t,level:r}}function L(t,r){if(r=r===!0?{all:!0}:r||{},isNaN(t)||t==e||0>t){var i=r.error||"--";return r.all?{text:i}:i}var o=w(t,r.steps,r.limit),a=o.value,l=a.toFixed(n(r.digit,2));return r.trim!==!1&&-1!=l.lastIndexOf(".")&&(l=l.replace(/\.?0+$/,"")),o.text=l+(r.join||"")+(r.units||P)[o.level+(r.start||0)],r.all?o:o.text}var N=Object.prototype.toString,B=Object.prototype.hasOwnProperty,C=Array.prototype.slice;a(Object,{forEach:function(t,e,n){for(var r in t)B.call(t,r)&&e.call(n,r,t[r],t)}}),a(Date,{now:function(){return+new Date}});var M;(t.ActiveXObject||t.msIndexedDB)&&(M=document.documentMode||(t.XMLHttpRequest?7:6)),t.JSON||(t.JSON={}),JSON.parse||(JSON.parse=l);var H,j;document.addEventListener?(H=function(t,e,n){t.addEventListener(e,n,!1)},j=function(t,e,n){t.removeEventListener(e,n,!1)}):document.attachEvent&&(H=function(t,e,n){t.attachEvent("on"+e,n)},j=function(t,e,n){t.detachEvent("on"+e,n)});var F=/^https?:\/\//i,P=["B","KB","MB","GB","TB","PB","EB"],T={def:n,isFunc:r,isUInt:i,fire:o,extend:a,ie:M,setOpacity:u,getOffset:c,walk:f,getPrev:s,getNext:v,getFirst:p,getLast:d,getChilds:h,createEle:g,parseHTML:E,isHttpURL:S,isSameHost:O,parseLevel:w,formatSize:L};M&&(T["ie"+(6>M?6:M)]=!0),T.event={fix:m,stop:x,trigger:b,add:y},t.Q=T}(window);
        //Q.upload 代码
        //build:2015/10/26 14:09:14
        !function(t,e){"use strict";function r(t){switch(t){case M:return"准备中";case N:return"上传中";case P:return"已完成";case O:return"已跳过";case R:return"已取消";case z:return"已失败"}return t}function i(){var e=t.XMLHttpRequest;e&&(new e).upload&&t.FormData&&(y=!0);var r=document.createElement("input");r.type="file",E=!!r.files,I=y}function a(t,e){var r=t.lastIndexOf(e);return-1!=r?t.slice(r):""}function n(t){if(t){for(var e=t.split(","),r={},i=0,a=e.length;a>i;i++)r[e[i]]=!0;return r}}function s(t,e){t.attachEvent?t.attachEvent("onload",e):t.addEventListener("load",e,!1)}function o(t,e,r){if(e&&!(0>=e)){var i,a=Date.now();if(r>=e)return i=a-t.timeStart,i&&(t.avgSpeed=Math.min(Math.round(1e3*e/i),e)),void(t.timeEnd=a);i=a-t.time,200>i||(t.speed=Math.min(Math.round(1e3*(r-t.loaded)/i),t.total),t.time=a)}}function d(t){var e=this;e.guid=t.guid||"uploader"+ ++b,e.url=t.url,e.dataType=t.dataType||"json",e.data=t.data,e.target=t.target,e.html5=y&&!!u(t.html5,!0),e.multiple=E&&e.html5&&!!u(t.multiple,!0),e.clickTrigger=I&&!!u(t.clickTrigger,!0),e.workerThread=e.html5?t.workerThread||1:1,e.workerIdle=e.workerThread,e.auto=t.auto!==!1,e.upName=t.upName||"upfile",e.allows=n(t.allows),e.disallows=n(t.disallows),e.container=t.container||document.body,t.getPos&&(e.getPos=t.getPos);var r=t.UI||{};r.init&&(e.init=r.init),r.draw&&(e.draw=r.draw),r.update&&(e.update=r.update),r.over&&(e.over=r.over),e.fns=t.on||{},e.ops=t,e.list=[],e.map={},e.index=0,e.started=!1,e._init()}var u=Q.def,l=Q.fire,p=Q.extend,c=Q.getFirst,f=Q.getLast,h=JSON.parse,m=Q.createEle,v=Q.parseHTML,g=Q.setOpacity,w=Q.getOffset,_=Q.event,T=_.add,k=_.trigger,x=_.stop,y=!1,E=!1,I=!1,b=0,L=0,S=0,M=0,N=1,P=2,O=-1,R=-2,z=-3;d.prototype={constructor:d,_init:function(){var t=this;if(!t._inited){t._inited=!0;var r=t.guid,i=t.target,a=t.container,n=m("div","upload-input "+r);if(a.appendChild(n),t.boxInput=n,!t.html5){var o="upload_iframe_"+r,d='<iframe class="u-iframe" name="'+o+'"></iframe><form class="u-form" action="" method="post" enctype="multipart/form-data" target="'+o+'"></form>',u=m("div","upload-html4 "+r,d);a.appendChild(u);var l=c(u),p=f(u);t.iframe=l,t.form=p,s(l,function(){if(0==t.workerIdle){var r;try{r=l.contentWindow.document.body.innerHTML}catch(i){}t.complete(e,P,r)}})}return t.clickTrigger?T(i,"click",function(e){t.fire("select",e)!==!1&&(t.resetInput(),k(t.inputFile,"click"))}):(T(n,"click",function(e){t.fire("select",e)===!1&&x(e)}),g(n,0),t.resetInput()),t.fire("init"),t.run("init")}},resetInput:function(){var t=this,e=t.boxInput,r=t.target,i=r.offsetWidth,a=r.offsetHeight;e.innerHTML='<input type="file" name="'+t.upName+'" style="'+(t.clickTrigger?"visibility: hidden;":"width:"+i+"px;height:"+a+"px;font-size:100px;")+'"'+(t.multiple?' multiple="multiple"':"")+">",e.style.width=i+"px",e.style.height=a+"px";var n=c(e);return T(n,"change",function(e){t.add(this),t.html5||t.resetInput()}),t.inputFile=n,t.updatePos(),t},updatePos:function(t){if(!this.clickTrigger){var e=this.getPos||w,r=this.boxInput,i=this.target,a=0==i.offsetWidth?{left:-1e4,top:-1e4}:e(i);r.style.left=a.left+"px",r.style.top=a.top+"px",t&&(r.style.zIndex=++S)}},fire:function(t,e,r){if(!r)return l(this.fns[t],this,e);var i=this.fns[t+"Async"];return i?l(i,this,e,r):void r(l(this.fns[t],this,e))},run:function(t,e){var r=this[t];return r&&l(r,this,e),this},addTask:function(t,e,r){if(t||e){var i,n;e?(i=e.name||e.fileName,n=e.size||e.fileSize):(i=a(t.value,"\\").slice(1)||t.value,n=-1);var s=this,o=a(i,".").toLowerCase(),d=s.disallows&&s.disallows[o]||s.allows&&!s.allows[o],u={id:++L,name:i,ext:o,size:n,input:t,file:e,arg:r,state:d?O:M};return d&&(u.disabled=!0),s.fire("add",u,function(t){t===!1||u.disabled||(u.index=s.list.length,s.list.push(u),s.map[u.id]=u,s.run("draw",u),s.auto&&s.start())}),u}},add:function(t){var r=this;if("INPUT"==t.tagName){var i=t.files;if(i)for(var a=0,n=i.length;n>a;a++)r.addTask(t,i[a]);else r.addTask(t)}else r.addTask(e,t)},addList:function(t){for(var e=0,r=t.length;r>e;e++)this.add(t[e])},get:function(t){return t!=e?this.map[t]:void 0},cancel:function(t){var e=this,r=e.get(t);if(r){var i=r.state;if(i!=M&&i!=N)return e;if(i==N){var a=r.xhr;if(a)return a.abort(),e;e.iframe.contentWindow.location="about:blank"}return e.complete(r,R)}},remove:function(t){var e=this.get(t);e&&(e.state==N&&this.cancel(t),e.deleted=!0,this.fire("remove",e))},start:function(){var t=this,e=t.workerIdle,r=t.list,i=t.index,a=r.length;if(t.started||(t.started=!0),0>=a||i>=a||0>=e)return t;var n=r[i];return t.index++,t.upload(n)},upload:function(t){var e=this;return!t||t.state!=M||t.skip?e.start():(t.url=e.url,e.workerIdle--,e.fire("upload",t,function(r){return r===!1?e.complete(t,O):void(e.html5&&t.file?e._upload_html5(t):t.input?e._upload_html4(t):e.complete(t,O))}),e)},_process_params:function(t,e){this.data&&Object.forEach(this.data,e),t.data&&Object.forEach(t.data,e)},_upload_html5:function(t){var e=this,r=new XMLHttpRequest;t.xhr=r,r.upload.addEventListener("progress",function(r){e.progress(t,r.total,r.loaded)},!1),r.addEventListener("load",function(r){e.complete(t,P,r.target.responseText)},!1),r.addEventListener("error",function(){e.complete(t,z)},!1),r.addEventListener("abort",function(){e.complete(t,R)},!1);var i=new FormData;e._process_params(t,function(t,e){i.append(t,e)}),i.append("fileName",t.name),i.append(e.upName,t.blob||t.file,t.name),r.open("POST",t.url),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.fire("send",t,function(a){return a===!1?e.complete(t,O):(r.send(i),void e._afterSend(t))})},_upload_html4:function(t){var e=this,r=e.form,i=t.input;return i._uploaded?e.complete(t,P):(i._uploaded=!0,i.name=e.upName,r.innerHTML="",r.appendChild(i),r.action=t.url,e._process_params(t,function(t,e){r.appendChild(v('<input type="hidden" name="'+t+'" value="'+e+'">'))}),void e.fire("send",t,function(i){return i===!1?e.complete(t,O):(r.submit(),void e._afterSend(t))}))},_afterSend:function(t){t.time=t.timeStart=Date.now(),t.state=N,this._lastTask=t,this.progress(t)},progress:function(t,e,r){e||(e=t.size),(!r||0>r)&&(r=0);var i=t.state||M;r>e&&(r=e),r>0&&i==M&&(t.state=i=N);var a=i==P;a&&(e=r=t.size),o(t,e,r),t.total=e,t.loaded=r,this.fire("progress",t),this.run("update",t)},_process_response:function(t,e){t.response=e,e&&"json"==this.dataType&&(t.json=h(e))},complete:function(t,r,i){var a=this;return t||1!=a.workerThread||(t=a._lastTask),t&&(r!=e&&(t.state=r),t.state==N&&(t.state=P,a.progress(t,t.size,t.size)),i!==e&&a._process_response(t,i)),r==R&&a.fire("cancel",t),a.fire("complete",t),a.run("over",t).run("update",t),a.workerIdle++,a.started&&a.start(),a}},d.extend=function(t,e){p(d.prototype,t,e)},i(),p(d,{support:{html5:y,multiple:E},READY:M,PROCESSING:N,COMPLETE:P,SKIP:O,CANCEL:R,ERROR:z,getStatusText:r}),Q.Uploader=d}(window);
        return window.Q;
    }

);
